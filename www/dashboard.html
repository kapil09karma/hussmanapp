<!DOCTYPE html>
<html>
<head>
<script>
function checklogin()
       { 
     if(localStorage.getItem('username')==null ){  window.location.assign("login.html");   }		   
	   }    

</script>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<link rel="stylesheet" type="text/css" href="css/index.css" />
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<link href="css/ionicons.min.css" rel="stylesheet" type="text/css" />
<link href="css/morris/morris.css" rel="stylesheet" type="text/css" />
<link href="css/jvectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
<link href="css/fullcalendar/fullcalendar.css" rel="stylesheet" type="text/css" />
<link href="css/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
<!-- bootstrap wysihtml5 - text editor -->
<!--<link href="css/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css" />
--><!-- Theme style -->
<link href="css/AdminLTE.css" rel="stylesheet" type="text/css" />

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
<title>Magnum Energy Solutions | Dashboard</title>
</head>
<body class="skin-blue" onLoad="checklogin()">
<header class="header"><a href="index.html" class="logo"> <!-- Add the class icon to your logo image or logo icon to add the margining --> 
  <img src="img/storevitals.png" style="width:220px" height="30px" /></a> 
  <!-- Header Navbar: style can be found in header.less -->
  <nav class="navbar navbar-static-top" role="navigation"> 
    <!-- Sidebar toggle button--> <a href="#" class="navbar-btn sidebar-toggle" data-toggle="offcanvas" role="button"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a>
    <div class="navbar-right">
      <ul class="nav navbar-nav">
        <!-- User Account: style can be found in dropdown.less -->
        <li class="dropdown user user-menu"> <a href="#" class="dropdown-toggle" data-toggle="dropdown"> <i class="glyphicon glyphicon-user"></i> <span id="disp_1"><i class="caret"></i></span> </a>
          <ul class="dropdown-menu">
            <!-- User image -->
            <li class="user-header bg-light-blue"> <img src="img/avatar5.png" class="img-circle" alt="User Image" />
              <p id="disp_2"></p>
            </li>
            <!-- Menu Footer-->
            <li class="user-footer">
              <div class="pull-right"> <a href="#" onClick="signout()" class="btn btn-default btn-flat">Sign out</a> </div>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </nav>
</header>
<div class="wrapper row-offcanvas row-offcanvas-left"> 
  <!-- Left side column. contains the logo and sidebar -->
  <aside class="left-side sidebar-offcanvas"><!-- sidebar: style can be found in sidebar.less -->
    <section class="sidebar"><!-- Sidebar user panel -->
      <div class="user-panel">
        <div class="pull-left image"><img src="img/avatar5.png" class="img-circle" alt="User Image" /></div>
        <div class="pull-left info">
          <p id="disp_3">Hello,</p>
          <a href="#"><i class="fa fa-circle text-success"></i> Online</a></div>
      </div>
      <!-- sidebar menu: : style can be found in sidebar.less -->
      <ul class="sidebar-menu">
        <li class="active"><a href="index.html"><i class="fa fa-home"></i><span>Home</span></a></li>
        <li class="active"><a href="dashboard.html"><i class="fa fa-dashboard"></i> <span>Dashboard</span></a></li>
        <li class="active"><a href="sensors.html"><i class="fa fa-signal"></i> <span>Sensors</span></a></li>
        <li class="active"><a href="events.html"><i class="fa fa-calendar"></i> <span>Events</span></a> </li>
        <li class="active"><a href="notifications.html"><i class="fa fa-globe"></i> <span>Notifications</span></a></li>
        <li class="active"><a href="analytics.html"> <i class="fa fa-bolt"></i></i><span>Analytics</span></a></li>
        <li class="active"><a href="#" onClick="signout()" ><i class="fa fa-sign-out"></i> </i><span>Logout</span></a></li>
      </ul>
    </section>
    <!-- /.sidebar --> 
  </aside>
  <!-- Right side column. Contains the navbar and content of the page -->
  <aside class="right-side"> 
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>Dashboard</h1>
      <ol class="breadcrumb">
        <li><a href="index.html"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Dashboard</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content"> <!-- Small boxes (Stat box) -->
      <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab_1" data-toggle="tab">Info</a></li>
          <li><a href="#tab_2" data-toggle="tab">Meter</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="tab_1">
            <div class="row">
              <div class="col-md-6">
                <div class="box box-danger" style="overflow:hidden;">
                  <div class="box-header"> 
                    <!-- tools box -->
                    <h3 class="box-title">Realtime Snapshot</h3>
                  </div>
                  <div class="col-lg-3 col-xs-6"><!-- small box -->
                    <div class="small-box bg-outofrange">
                      <div class="inner" style="cursor:pointer;" id="out_of_range_m_1">
                        <h3 id="issue_out_of_range_data">0</h3>
                        <p style="font-size:16px">Out of range</p>
                      </div>
                    </div>
                  </div>
                  <!-- ./col -->
                  <div class="col-lg-3 col-xs-6"><!-- small box -->
                    <div class="small-box bg-opendoor">
                      <div class="inner" style="cursor:pointer;" id="open_door_m_1" >
                        <h3 id="issueopendoordata">0</h3>
                        <p style="font-size:16px">Open Door</p>
                      </div>
                    </div>
                  </div>
                  <!-- ./col -->
                  <div class="col-lg-3 col-xs-6"><!-- small box -->
                    <div class="small-box bg-totalsensor">
                      <div class="inner" style="cursor:pointer;" id="total_sensor_m_1">
                        <h3 id="issuetotal_sensor">0</h3>
                        <p style="font-size:16px">Total Sensor</p>
                      </div>
                    </div>
                  </div>
                  <!-- ./col -->
                  <div class="col-lg-3 col-xs-6"><!-- small box -->
                    <div class="small-box bg-notworking">
                      <div class="inner" style="cursor:pointer;" id="not_working_m_1" >
                        <h3 id="issuenot_working">0</h3>
                        <p style="font-size:16px">Not Working</p>
                      </div>
                    </div>
                  </div>
                  <!-- ./col -->
                  <div class="col-lg-3 col-xs-6"><!-- small box -->
                    <div class="small-box bg-flapping">
                      <div class="inner" style="cursor:pointer;" id="flapping_m_1">
                        <h3 id="issue_flapping">0</h3>
                        <p style="font-size:16px">Flapping</p>
                      </div>
                    </div>
                  </div>
                  <!-- ./col --></div>
              </div>
              <div class="col-md-6"><!-- general form elements -->
                <div class="box box-danger">
                  <div class="box-header">
                    <h3 class="box-title">Unacknowledged Snapshot View</h3>
                  </div>
                  <!-- /.box-header -->
                  <div class="pad"><!-- Progress bars -->
                    <div class="clearfix"><span class="pull-left tevs_1" style="cursor:pointer;">Total events</span> <small class="pull-right tevs_1" id="event_up_1" style="cursor:pointer;">0</small></div>
                    <div class="progress xs tevs_1">
                      <div class="progress-bar progress-bar-events tevs_1" id="progress_1" style="width: 0%;"></div>
                    </div>
                    <div class="clearfix"> <span class="pull-left tevs_2" style="cursor:pointer;">Out of range</span><small class="pull-right tevs_2" id="out_of_range_up_2">0</small></div>
                    <div class="progress xs tevs_2">
                      <div class="progress-bar progress-bar-outofrange" id="out_of_range_style" style="width: 0%;"></div>
                    </div>
                    <div class="clearfix"><span class="pull-left tevs_3" style="cursor:pointer;">Open door</span><small class="pull-right tevs_3" id="open_door_up_2">0</small></div>
                    <div class="progress xs tevs_3">
                      <div class="progress-bar progress-bar-opendoor" id="open_door_up_style_2" style="width: 0%;"></div>
                    </div>
                    <div class="clearfix"><span class="pull-left tevs_4" style="cursor:pointer;">Not working</span><small class="pull-right tevs_4" id="not_working_up_2" >0</small> </div>
                    <div class="progress xs tevs_4">
                      <div class="progress-bar progress-bar-notworking" id="not_working_up_style" style="width: 0%;"></div>
                    </div>
                    <div class="clearfix"><span class="pull-left tevs_5" style="cursor:pointer;" >Flapping</span> <small class="pull-right tevs_5" id="flapping_up_2" >0</small></div>
                    <div class="progress xs tevs_5">
                      <div class="progress-bar progress-bar-flapping" id="flapping_up_style" style="width: 0%;"></div>
                    </div>
                    <div class="clearfix"><span class="pull-left tevs_6" style="cursor:pointer;">Notifications</span><small class="pull-right tevs_6" id="notifications_up_1">0</small></div>
                    <div class="progress xs tevs_6">
                      <div class="progress-bar progress-bar-notification" id="notifications_up_1_style" style="width: 0%;"></div>
                    </div>
                  </div>
                </div>
                <!-- /.box --></div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="box box-danger" id="loading-example">
                  <div class="box-header"><!-- tools box -->
                    <h3 class="box-title">Unacknowledged Event Locations</h3>
                  </div>
                  <div class="box-body chart-responsive">
                    <div class="chart" id="bar-chart" style="height:300px;"></div>
                  </div>
                  <!-- /.box-body --></div>
              </div>
              <?php $user_id = $_SESSION['user_id']; $locationstr = ""; $dataarray = ""; $annotationarray = "";
$Query = "SELECT * from ".'setup.stp$user_map_loc'." where";  $Query .= " uml_user_id='".$user_id."'";   $result = pg_query($Query);
while($row = pg_fetch_array($result)){ $locationstr.= $row['uml_location_id'].",";  }  $locationstr = substr($locationstr,0,strlen($locationstr)-1);
$Query1 = "SELECT * from ".'master.mtr$loc_wise_evnt_count_vw'." where"; $Query1 .= " loc_id IN (".$locationstr.")"; $result1 = pg_query($Query1); $locationname = "";
?>
              <div class="col-md-6">
                <div class="box box-danger" id="loading-example">
                  <div class="box-header"><!-- tools box -->
                    <h3 class="box-title">Unacknowleged Event Details</h3>
                  </div>
                  <div class="box-body table-responsive pad"><!-- chat item -->
                    <table class="table table-bordered text-center">
                      <tbody>
                        <?php while($row1 = pg_fetch_array($result1)){ $tot =  $row1['event_type_1'] + $row1['event_type_2'] + $row1['event_type_3'] + $row1['event_type_7']; ?>
                        <tr>
                          <td><?=$row1['location_name']?></td>
                          <td><div class="row">
                              <div class="col-xs-2 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" data-max="<?=$tot?>" value="<?=$row1['event_type_1']?>" data-width="50" data-height="50" data-fgColor="#85ccd2"/>
                                <div class="knob-label"><b>Out of range</b></div>
                              </div>
                              <!-- ./col --></div></td>
                          <td><div class="row">
                              <div class="col-xs-2 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" data-max="<?=$tot?>" value="<?=$row1['event_type_2']?>" data-width="50" data-height="50" data-fgColor="#e95a38"/>
                                <div class="knob-label"><b>Not working</b></div>
                              </div>
                              <!-- ./col --></div></td>
                          <td><div class="row">
                              <div class="col-xs-2 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" data-max="<?=$tot?>" value="<?=$row1['event_type_3']?>" data-width="50" data-height="50" data-fgColor="#fad55c"/>
                                <div class="knob-label"><b>Flapping</b></div>
                              </div>
                              <!-- ./col --></div></td>
                          <td><div class="row">
                              <div class="col-xs-2 text-center" style="border-right: 1px solid #f4f4f4">
                                <input type="text" class="knob" data-readonly="true" data-max="<?=$tot?>" value="<?=$row1['event_type_7']?>" data-width="50" data-height="50" data-fgColor="#465cdf"/>
                                <div class="knob-label"><b>Open door</b></div>
                              </div>
                              <!-- ./col --></div></td>
                          <td><b><?php echo $tot; ?></b></td>
                        </tr>
                        <?php } ?>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane" id="tab_2">
            <?php  $Query1_mtr = "SELECT * from ".'master.mtr$meter'." where"; $Query1_mtr .= " meter_loc_id IN (".$locationstr.")"; $result_2 = pg_query($Query1_mtr); ?>
            <select name="meter_sel" id="meter_sel" onChange="meter_change(this.value);"  >
              <?php $mr_no = 0; while($itm_1 =  pg_fetch_array($result_2)){   $mr_no = $mr_no +1;  if($mr_no==1){ $ok = $itm_1['meter_url']; } ?>
              <option value="<?=$itm_1['meter_url']?>">
              <?=$itm_1['meter_name']?>
              </option>
              <?php } ?>
            </select>
            <div class="row"><br/>
              <iframe src="<?=$ok?>" frameborder="0" id="meterlocation_space" height="100%" width="100%" style="min-height:500px" ></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- /.content --></aside>
  <!-- /.right-side --></div>
  
<script src="js/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<!-- Morris.js charts -->
<script src="js/raphael-min.js"></script>
<script src="js/plugins/morris/morris.min.js" type="text/javascript"></script>
<!-- AdminLTE App -->
<script src="js/AdminLTE/app.js" type="text/javascript"></script>
<script src="js/plugins/jqueryKnob/jquery.knob.js" type="text/javascript"></script>
<script src="js/plugins/sparkline/jquery.sparkline.min.js" type="text/javascript"></script>
<script src="js/AdminLTE/dashboard_home.js" type="text/javascript"></script>        
<script src="js/jquery-ui-1.10.3.min.js" type="text/javascript"></script>
<script src="js/plugins/datatables/jquery.dataTables.js" type="text/javascript"></script> 
<script src="js/plugins/datatables/dataTables.bootstrap.js" type="text/javascript"></script> 
  
<script>
//display username in three locations in page
document.getElementById('disp_1').innerHTML = localStorage.getItem('username');
document.getElementById('disp_2').innerHTML = localStorage.getItem('username');
document.getElementById('disp_3').innerHTML = 'Hello,'+localStorage.getItem('username');

//function for signout//--------
function signout()
         {
			localStorage.removeItem("username");	 
			localStorage.removeItem("userid");	 
			localStorage.removeItem("sloc_id");	
			window.location.assign("login.html");  
		 }  



$.getJSON( "http://204.14.40.108:8888/real_time?userid="+localStorage.getItem('userid'), {} )
.done(function( json ) {
	document.getElementById("issue_out_of_range_data").innerHTML = json[0].out_range_count;
	document.getElementById("issueopendoordata").innerHTML = json[0].open_door_count;
	document.getElementById("issuetotal_sensor").innerHTML = json[0].tot_ses_count;
	document.getElementById("issuenot_working").innerHTML = json[0].not_working_count;
	document.getElementById("issue_flapping").innerHTML = json[0].sen_flapping_count;
})
		 
</script>

</body>
</html>